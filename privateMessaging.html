<html>
	<head>
		<style type="text/css">
		#chat {height:300px}
		#chatWrap {float: left; border: 1px #000 solid;}
		#contentWrap{display: none}
		
		</style>
		
		<script>
  			var query = window.location.search;
  			// Skip the leading ?, which should always be there, 
  			// but be careful anyway
  			if (query.substring(0, 1) == '?') {
    			query = query.substring(1);
  			}
		</script>
		</script>
		<title>
			Private messaging
		</title>
	</head>
	<body>
		<div id="contentWrap">
			<div id="chatWrap">
				<div id="chat"></div>
				<form id="sendMessageform">
					<input size="35" id="messageBox"></input>
					<input type="submit"></input>
				</form>
			</div>
			<div id="users"></div>
		</div>

		<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script type="text/javascript">
			jQuery(function($){
				var socket = io.connect();
				var $Chat = $('#chat');
				var $SendMessageForm = $('#sendMessageform');
				var $messageBox = $('#messageBox');
				
				var $userList = $('#users');

				$SendMessageForm.submit(function(e){
					e.preventDefault();
					socket.emit('chat msg',$messageBox.val(),function(data){
						$Chat.append("<span class='error'><b>"+data+ "</span></br>");
					});
					$messageBox.val('');
				});

				socket.on('new msg', function(data){
					$Chat.append("<b>"+data.nick +":</b>" +data.msg + "</br>");
				});

				socket.on('Whisper', function(data){
					$Chat.append("<span class='whisper'><b>"+data.nick +":</b>" +data.msg + "</span></br>");
				});

				socket.on('usernames',function(data){
					var html = '<ul></br>';
					for (var i = 0; i < data.length; i++) {
						html += '<li id="listItem" ondblclick=myFunction(this)' + '>' + data[i] + '</li></br>';
					};
					html += '</ul></br>';
					$userList.html(html);
				});
			});
		</script>
	</body>
</html>