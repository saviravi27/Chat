<html>
	<head>
		<style type="text/css">
		#chat {height:300px}
		#chatWrap {float: left; border: 1px #000 solid;}
		#contentWrap{display: none}
		#NickError{color: red; display: none}
		.error{color: red;}
		.whisper{color: gray; font-family: italic}
		.selected { color: Red; }
		.myChatLoginButton {
	-moz-box-shadow: 0px 0px 0px 2px #9fb4f2;
	-webkit-box-shadow: 0px 0px 0px 2px #9fb4f2;
	box-shadow: 0px 0px 0px 2px #9fb4f2;
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #7892c2), color-stop(1, #476e9e));
	background:-moz-linear-gradient(top, #7892c2 5%, #476e9e 100%);
	background:-webkit-linear-gradient(top, #7892c2 5%, #476e9e 100%);
	background:-o-linear-gradient(top, #7892c2 5%, #476e9e 100%);
	background:-ms-linear-gradient(top, #7892c2 5%, #476e9e 100%);
	background:linear-gradient(to bottom, #7892c2 5%, #476e9e 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#7892c2', endColorstr='#476e9e',GradientType=0);
	background-color:#7892c2;
	-moz-border-radius:10px;
	-webkit-border-radius:10px;
	border-radius:10px;
	border:1px solid #4e6096;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:12px;
	padding:4px 16px;
	text-decoration:none;
	text-shadow:0px 1px 0px #283966;
}
.myChatLoginButton:hover {
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #476e9e), color-stop(1, #7892c2));
	background:-moz-linear-gradient(top, #476e9e 5%, #7892c2 100%);
	background:-webkit-linear-gradient(top, #476e9e 5%, #7892c2 100%);
	background:-o-linear-gradient(top, #476e9e 5%, #7892c2 100%);
	background:-ms-linear-gradient(top, #476e9e 5%, #7892c2 100%);
	background:linear-gradient(to bottom, #476e9e 5%, #7892c2 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#476e9e', endColorstr='#7892c2',GradientType=0);
	background-color:#476e9e;
}
.myChatLoginButton:active {
	position:relative;
	top:1px;
}

.myChatSendButton {
	-moz-box-shadow: 0px 0px 0px 2px #9fb4f2;
	-webkit-box-shadow: 0px 0px 0px 2px #9fb4f2;
	box-shadow: 0px 0px 0px 2px #9fb4f2;
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #7892c2), color-stop(1, #476e9e));
	background:-moz-linear-gradient(top, #7892c2 5%, #476e9e 100%);
	background:-webkit-linear-gradient(top, #7892c2 5%, #476e9e 100%);
	background:-o-linear-gradient(top, #7892c2 5%, #476e9e 100%);
	background:-ms-linear-gradient(top, #7892c2 5%, #476e9e 100%);
	background:linear-gradient(to bottom, #7892c2 5%, #476e9e 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#7892c2', endColorstr='#476e9e',GradientType=0);
	background-color:#7892c2;
	-moz-border-radius:10px;
	-webkit-border-radius:10px;
	border-radius:10px;
	border:1px solid #4e6096;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:12px;
	padding:4px 16px;
	text-decoration:none;
	text-shadow:0px 1px 0px #283966;
}
.myChatSendButton:hover {
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #476e9e), color-stop(1, #7892c2));
	background:-moz-linear-gradient(top, #476e9e 5%, #7892c2 100%);
	background:-webkit-linear-gradient(top, #476e9e 5%, #7892c2 100%);
	background:-o-linear-gradient(top, #476e9e 5%, #7892c2 100%);
	background:-ms-linear-gradient(top, #476e9e 5%, #7892c2 100%);
	background:linear-gradient(to bottom, #476e9e 5%, #7892c2 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#476e9e', endColorstr='#7892c2',GradientType=0);
	background-color:#476e9e;
}
.myChatSendButton:active {
	position:relative;
	top:1px;
}
.myLi:hover {cursor: hand; cursor: pointer;}
			
			
			.myLi
			{
			padding-right: .6em;
			}

		</style>
		<!--<link rel="stylesheet" type="text/css" href="/styles/mystyle.css">-->
		<script type="text/javascript">
		function myPrivateMessaging(data) {
			var myWindow = window.open("/privateMessaging.html?name="+data.innerHTML, "MsgWindow", "width=400, height=350");
		}
		</script>
		<title>
			Chat application
		</title>
	</head>
	<body>
		<div id="NickWrap">
			<p><b>Enter a Username:</b></p>
			<form id="NickForm">
				<input size=35 id="Nicktextbox" />
				<input type="submit" value="login" class="myChatLoginButton"/>
			</form>
			<div id="NickError" >That username already exists! Try again</div>
		</div>
		<div id="contentWrap">
			<div id="chatWrap">
				<div id="chat"></div>
				<form id="sendMessageform">
					<input size="35" id="messageBox"></input>
					<input type="submit" value="send" class = "myChatSendButton"></input>
				</form>
			</div>
			<div id="users"><h2>User List</h2></div>
		</div>

		<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script type="text/javascript">
		jQuery(function($){
			var socket = io.connect();
			var $Chat = $('#chat');
			var $SendMessageForm = $('#sendMessageform');
			var $messageBox = $('#messageBox');
			var $nickform = $('#NickForm');
			var $nickerror = $('#NickError');
			var $nickmessagebox = $('#Nicktextbox');
			var $userList = $('#users');
			
			var numberOfRandomClients = 2;
			var EmployeeName = '';
			
			$nickmessagebox.ready(function(){
				var employee = 'Employee';
				socket.emit('get user', employee);
			});

			socket.on('get user result', function(data){
				if(data)
				{
					//user can be added
					$nickmessagebox.val(data);
					socket.emit('count users');
				}
			});
			
			socket.on('count users result', function(count){
				//alert(count);
				if(count < numberOfRandomClients)
				{
					//auto submit
					$nickform.submit();
					window.open("/", "_blank");
				}
			});

			$nickform.submit(function(e){
				e.preventDefault();
				EmployeeName = $nickmessagebox.val();
				socket.emit('new user',$nickmessagebox.val(),function(data){
					if(data){
						$('#NickWrap').hide();
						$('#contentWrap').show();
						$('#usrList li').css("font-weight","Bold");
					}
					else{
						$nickerror.show();
					}
				});
				$nickmessagebox.val('');
			});

			$SendMessageForm.submit(function(e){
				e.preventDefault();
				socket.emit('chat msg',$messageBox.val(),function(data){
					$Chat.append("<span class='error'><b>"+data+ "</span></br>");
				});
				$messageBox.val('');
			});

			socket.on('new msg', function(data){
				$Chat.append("<b>"+data.nick +":</b>" +data.msg + "</br>");
			});

			socket.on('Whisper', function(data){
				$Chat.append("<span class='whisper'><b>"+data.nick +":</b>" +data.msg + "</span></br>");
			});

			socket.on('usernames',function(keys){
				var html = '<ul id = "usrList"></br>';
				
				for (var i = 0; i < keys.length; i++) {
					var li = '<li id="listItem" class="myLi" onclick=myPrivateMessaging(this)>';
					if(EmployeeName == keys[i])
					{
						li = '<li id="listItem" class="selected">';
					}
					html += li +  keys[i] + '</li></br>';
				};
				html += '</ul></br>';
				$userList.html(html);
			});
		});
		</script>
	</body>
</html>